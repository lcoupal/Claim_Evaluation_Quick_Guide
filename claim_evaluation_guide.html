<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Evaluation Quick Guide | Exploring Systems Like a Scientist</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --wgu-navy: #003057;
            --wgu-blue: #0077c8;
            --wgu-light-blue: #69b3e7;
            --wgu-gold: #b9975b;
            --success: #2e7d32;
            --success-light: #e8f5e9;
            --warning: #c62828;
            --warning-light: #ffebee;
            --caution: #ef6c00;
            --caution-light: #fff3e0;
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-600: #757575;
            --gray-800: #424242;
            --gray-900: #212121;
            --comp1: #0077c8;
            --comp2: #6b46c1;
            --comp3: #2e7d32;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', sans-serif; background: var(--gray-100); color: var(--gray-900); line-height: 1.6; }

        header { background: var(--wgu-navy); color: var(--white); padding: 30px 20px; }
        .header-content { max-width: 900px; margin: 0 auto; }
        .course-label { display: inline-block; background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
        header h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 6px; }
        header p { opacity: 0.85; font-size: 0.95rem; }

        .nav-bar { background: var(--white); border-bottom: 1px solid var(--gray-300); padding: 16px 20px; position: sticky; top: 0; z-index: 100; }
        .nav-bar-inner { max-width: 900px; margin: 0 auto; }
        .nav-bar-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        
        .comp-tabs { display: flex; gap: 4px; }
        .comp-tab { padding: 10px 20px; border: none; background: var(--gray-100); font-size: 0.85rem; font-weight: 600; cursor: pointer; font-family: inherit; border-radius: 6px 6px 0 0; color: var(--gray-600); transition: all 0.2s; }
        .comp-tab:hover { background: var(--gray-200); }
        .comp-tab.active { color: var(--white); }
        .comp-tab[data-comp="1"].active { background: var(--comp1); }
        .comp-tab[data-comp="2"].active { background: var(--comp2); }
        .comp-tab[data-comp="3"].active { background: var(--comp3); }

        .view-toggle { display: flex; align-items: center; gap: 8px; }
        .view-toggle-label { font-size: 0.8rem; color: var(--gray-600); }
        .toggle-switch { position: relative; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--gray-300); border-radius: 26px; transition: 0.3s; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: var(--wgu-blue); }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(24px); }

        .save-indicator { font-size: 0.8rem; color: var(--success); font-weight: 500; }

        .progress-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .progress-label { font-size: 0.75rem; color: var(--gray-600); }
        .progress-percent { font-weight: 700; color: var(--wgu-blue); font-size: 0.8rem; }
        .progress-bar { height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--wgu-blue), var(--wgu-light-blue)); border-radius: 3px; transition: width 0.5s ease; }

        main { max-width: 900px; margin: 0 auto; padding: 24px 20px; }

        .student-info { background: var(--white); border: 1px solid var(--gray-300); border-radius: 8px; padding: 20px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .info-field label { display: block; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
        .info-field input { width: 100%; padding: 10px 12px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 0.9rem; font-family: inherit; }
        .info-field input:focus { outline: none; border-color: var(--wgu-blue); box-shadow: 0 0 0 3px rgba(0, 119, 200, 0.15); }

        /* Competency Sections */
        .comp-section { background: var(--white); border: 1px solid var(--gray-300); border-radius: 8px; margin-bottom: 20px; overflow: hidden; display: none; }
        .comp-section.visible { display: block; }

        .comp-section-header { padding: 20px; color: var(--white); }
        .comp-section.comp1 .comp-section-header { background: var(--comp1); }
        .comp-section.comp2 .comp-section-header { background: var(--comp2); }
        .comp-section.comp3 .comp-section-header { background: var(--comp3); }
        .comp-section-header h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; }
        .comp-section-header p { font-size: 0.85rem; opacity: 0.9; }

        .comp-section-body { padding: 20px; }

        /* Lesson Management */
        .lessons-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--wgu-gold); }
        .lessons-header h3 { font-size: 0.95rem; font-weight: 700; color: var(--wgu-navy); }
        .add-lesson-btn { padding: 6px 12px; background: var(--white); border: 1px solid var(--wgu-blue); color: var(--wgu-blue); border-radius: 4px; font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: inherit; }
        .add-lesson-btn:hover { background: var(--wgu-blue); color: var(--white); }

        /* Lesson Cards */
        .lesson-card { border: 1px solid var(--gray-300); border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
        .lesson-card-header { padding: 12px 16px; background: var(--gray-50); border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; gap: 12px; }
        .lesson-name-input { flex: 1; padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 0.9rem; font-weight: 600; font-family: inherit; color: var(--wgu-navy); }
        .lesson-name-input:focus { outline: none; border-color: var(--wgu-blue); }
        .lesson-actions { display: flex; gap: 8px; }
        .lesson-toggle-btn { background: none; border: none; color: var(--gray-600); cursor: pointer; font-size: 0.8rem; padding: 4px 8px; }
        .delete-lesson-btn { background: none; border: 1px solid var(--gray-300); color: var(--gray-600); padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; font-family: inherit; }
        .delete-lesson-btn:hover { background: var(--warning-light); border-color: var(--warning); color: var(--warning); }

        .lesson-card-body { padding: 16px; display: none; }
        .lesson-card.open .lesson-card-body { display: block; }
        .lesson-card.open .lesson-toggle-btn { transform: rotate(180deg); }

        .content-block { margin-bottom: 20px; }
        .content-block:last-child { margin-bottom: 0; }
        .content-block-title { font-size: 0.85rem; font-weight: 700; color: var(--gray-800); margin-bottom: 10px; }

        /* Notes */
        .notes-container { margin: 8px 0; }
        .note-card { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 6px; padding: 10px; margin-bottom: 8px; }
        .note-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .note-date { font-size: 0.7rem; color: var(--gray-400); }
        .note-card textarea { width: 100%; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 0.85rem; font-family: inherit; resize: vertical; min-height: 50px; }
        .note-card textarea:focus { outline: none; border-color: var(--wgu-blue); }
        .delete-btn { background: none; border: none; color: var(--gray-400); cursor: pointer; font-size: 1rem; padding: 2px 6px; border-radius: 4px; }
        .delete-btn:hover { color: var(--warning); background: var(--warning-light); }

        .add-btn { width: 100%; padding: 10px; background: var(--white); border: 2px dashed var(--gray-300); border-radius: 6px; color: var(--gray-600); font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: inherit; }
        .add-btn:hover { border-color: var(--wgu-blue); color: var(--wgu-blue); }

        /* Examples */
        .example-card { background: var(--white); border: 1px solid var(--gray-200); border-radius: 6px; margin-bottom: 10px; overflow: hidden; }
        .example-header { padding: 10px 14px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--gray-200); background: var(--gray-50); }
        .example-header h4 { font-size: 0.8rem; font-weight: 700; color: var(--gray-800); }
        .example-date { font-size: 0.65rem; color: var(--gray-400); margin-left: 8px; }
        .example-body { padding: 14px; }
        .example-field { margin-bottom: 12px; }
        .example-field:last-child { margin-bottom: 0; }
        .example-field label { display: block; font-size: 0.7rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; margin-bottom: 4px; }
        .example-field textarea, .example-field input { width: 100%; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 0.85rem; font-family: inherit; resize: vertical; }
        .example-field textarea { min-height: 50px; }
        .example-field textarea:focus, .example-field input:focus { outline: none; border-color: var(--wgu-blue); }
        .verdict-select { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .verdict-option { padding: 8px; border: 2px solid var(--gray-300); border-radius: 4px; text-align: center; cursor: pointer; font-size: 0.75rem; font-weight: 600; background: var(--white); }
        .verdict-option:hover { border-color: var(--wgu-blue); }
        .verdict-option.selected.strong { background: var(--success-light); border-color: var(--success); color: var(--success); }
        .verdict-option.selected.weak { background: var(--warning-light); border-color: var(--warning); color: var(--warning); }
        .verdict-option.selected.mixed { background: var(--caution-light); border-color: var(--caution); color: var(--caution); }

        /* Images */
        .image-upload-area { border: 2px dashed var(--gray-300); border-radius: 6px; padding: 16px; text-align: center; margin: 8px 0; cursor: pointer; }
        .image-upload-area:hover { border-color: var(--wgu-blue); background: rgba(0, 119, 200, 0.03); }
        .image-upload-area input[type="file"] { display: none; }
        .upload-icon { font-size: 1.2rem; color: var(--gray-400); margin-bottom: 4px; }
        .upload-text { font-size: 0.8rem; color: var(--gray-600); }

        .images-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 10px; }
        .image-card { position: relative; border: 1px solid var(--gray-300); border-radius: 6px; overflow: hidden; background: var(--white); }
        .image-card img { width: 100%; height: 100px; object-fit: cover; display: block; }
        .image-card .image-caption { padding: 6px; border-top: 1px solid var(--gray-200); }
        .image-card .image-caption input { width: 100%; padding: 4px; border: 1px solid var(--gray-300); border-radius: 3px; font-size: 0.7rem; font-family: inherit; }
        .image-card .remove-btn { position: absolute; top: 4px; right: 4px; width: 20px; height: 20px; background: var(--white); border: 1px solid var(--gray-300); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: var(--gray-600); }
        .image-card .remove-btn:hover { background: var(--warning-light); border-color: var(--warning); color: var(--warning); }

        /* Reference Content */
        .ref-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 12px 0; }
        .ref-card { background: var(--white); border-radius: 6px; padding: 12px; border: 1px solid var(--gray-300); border-left: 3px solid var(--wgu-navy); }
        .ref-card h4 { font-size: 0.8rem; font-weight: 700; margin-bottom: 6px; color: var(--gray-900); }
        .ref-card ul { margin-left: 14px; font-size: 0.75rem; color: var(--gray-800); }
        .ref-card li { margin-bottom: 3px; }

        .source-table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 0.75rem; }
        .source-table th { background: var(--wgu-navy); color: var(--white); padding: 8px; text-align: left; font-weight: 600; }
        .source-table th:first-child { border-radius: 4px 0 0 0; }
        .source-table th:last-child { border-radius: 0 4px 0 0; }
        .source-table th.strong { background: var(--success); }
        .source-table th.weak { background: var(--warning); }
        .source-table td { padding: 8px; border-bottom: 1px solid var(--gray-200); }
        .source-table td:first-child { font-weight: 600; background: var(--gray-50); color: var(--wgu-navy); }

        /* Quick Check */
        .quick-check { background: var(--wgu-navy); border-radius: 8px; padding: 16px; color: var(--white); margin-bottom: 20px; }
        .quick-check-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .quick-check h3 { font-size: 0.9rem; font-weight: 700; }
        .add-question-btn { padding: 4px 10px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: var(--white); border-radius: 4px; font-size: 0.75rem; font-weight: 600; cursor: pointer; font-family: inherit; }
        .add-question-btn:hover { background: rgba(255,255,255,0.25); }
        .quick-check-questions { display: flex; flex-direction: column; gap: 8px; }
        .question-item { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.15); padding: 10px 14px; border-radius: 4px; width: 100%; }
        .question-item input { background: transparent; border: none; color: var(--white); font-size: 0.85rem; font-family: inherit; flex: 1; }
        .question-item input:focus { outline: none; }
        .question-item input::placeholder { color: rgba(255,255,255,0.5); }
        .question-num { font-weight: 700; color: var(--wgu-gold); font-size: 0.85rem; min-width: 20px; }
        .delete-question-btn { background: none; border: none; color: rgba(255,255,255,0.5); cursor: pointer; font-size: 1rem; padding: 2px 6px; }
        .delete-question-btn:hover { color: var(--white); }

        .action-buttons { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
        .action-btn { padding: 12px 24px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; border: none; font-family: inherit; }
        .action-btn.primary { background: var(--wgu-blue); color: var(--white); }
        .action-btn.primary:hover { background: var(--wgu-navy); }
        .action-btn.secondary { background: var(--white); color: var(--gray-800); border: 1px solid var(--gray-300); }
        .action-btn.secondary:hover { background: var(--gray-100); }
        .action-btn.danger { background: var(--white); color: var(--warning); border: 1px solid var(--warning); }
        .action-btn.danger:hover { background: var(--warning-light); }

        footer { text-align: center; padding: 24px 20px; color: var(--gray-600); font-size: 0.8rem; border-top: 1px solid var(--gray-300); margin-top: 32px; background: var(--white); }
        footer strong { color: var(--wgu-navy); }

        @media print {
            .nav-bar, .action-buttons, .add-btn, .add-lesson-btn, .delete-btn, .delete-lesson-btn, .remove-btn, .lesson-toggle-btn, .image-upload-area, .add-question-btn, .delete-question-btn { display: none !important; }
            .comp-section { display: block !important; break-inside: avoid; page-break-inside: avoid; }
            .lesson-card { break-inside: avoid; page-break-inside: avoid; }
            .lesson-card-body { display: block !important; }
            .quick-check { break-inside: avoid; page-break-inside: avoid; }
            .example-card { break-inside: avoid; page-break-inside: avoid; }
            .note-card { break-inside: avoid; page-break-inside: avoid; }
            .content-block { break-inside: avoid; page-break-inside: avoid; }
            .ref-grid { break-inside: avoid; page-break-inside: avoid; }
            .image-card { break-inside: avoid; page-break-inside: avoid; }
            header, .comp-section-header, .quick-check { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }

        @media (max-width: 640px) {
            .student-info { grid-template-columns: 1fr; }
            .ref-grid { grid-template-columns: 1fr; }
            .verdict-select { grid-template-columns: 1fr; }
            .quick-check-steps { flex-direction: column; }
            .quick-check-arrow { display: none; }
            .action-buttons { flex-direction: column; }
            .comp-tabs { width: 100%; }
            .comp-tab { flex: 1; text-align: center; padding: 10px 8px; font-size: 0.75rem; }
            .nav-bar-row { flex-direction: column; align-items: stretch; }
            .view-toggle { justify-content: center; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="course-label">Exploring Systems Like a Scientist</div>
            <h1>Claim Evaluation Quick Guide</h1>
            <p>Your personal reference for evaluating scientific claims — built throughout the course</p>
        </div>
    </header>

    <div class="nav-bar">
        <div class="nav-bar-inner">
            <div class="nav-bar-row">
                <div class="comp-tabs">
                    <button class="comp-tab active" data-comp="1" onclick="setComp('1')">Competency 1</button>
                    <button class="comp-tab" data-comp="2" onclick="setComp('2')">Competency 2</button>
                    <button class="comp-tab" data-comp="3" onclick="setComp('3')">Competency 3</button>
                </div>
                <div class="view-toggle">
                    <span class="view-toggle-label">Current Only</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="viewToggle" onchange="toggleView()">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="view-toggle-label">Show All</span>
                </div>
                <div class="save-indicator" id="saveIndicator">Auto-saved</div>
            </div>
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-label">Overall Progress</span>
                    <span class="progress-percent" id="progressPercent">0% Complete</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <main>
        <div class="student-info">
            <div class="info-field">
                <label>Your Name</label>
                <input type="text" id="studentName" placeholder="Enter your name" oninput="saveData()">
            </div>
            <div class="info-field">
                <label>Last Updated</label>
                <input type="text" id="lastUpdated" readonly>
            </div>
        </div>

        <!-- COMPETENCY 1 -->
        <div class="comp-section comp1 visible" id="comp1Section">
            <div class="comp-section-header">
                <h2>Competency 1: Supports a Scientific Claim</h2>
                <p>Identify credible evidence and translate scientific language</p>
            </div>
            <div class="comp-section-body">
                <div class="quick-check">
                    <div class="quick-check-header">
                        <h3>My Quick Check: Evidence Questions</h3>
                        <button class="add-question-btn" onclick="addQuestion('1')">+ Add</button>
                    </div>
                    <div class="quick-check-questions" id="questions-comp1"></div>
                </div>
                <div class="lessons-header">
                    <h3>Lessons</h3>
                    <button class="add-lesson-btn" onclick="addLesson('1')">+ Add Lesson</button>
                </div>
                <div id="lessons-comp1"></div>
            </div>
        </div>

        <!-- COMPETENCY 2 -->
        <div class="comp-section comp2" id="comp2Section">
            <div class="comp-section-header">
                <h2>Competency 2: Evaluates Scientific Claims</h2>
                <p>Apply evaluation criteria and identify misinformation</p>
            </div>
            <div class="comp-section-body">
                <!-- Reference Content for Comp 2 -->
                <div style="margin-bottom: 20px;">
                    <div class="content-block-title">Quick Reference: Red Flags</div>
                    <div class="ref-grid">
                        <div class="ref-card"><h4>Correlation ≠ Causation</h4><ul><li>No mechanism explained</li><li>Ignores alternatives</li></ul></div>
                        <div class="ref-card"><h4>Missing Evidence</h4><ul><li>"Research shows..." (no cite)</li><li>Anecdotes not data</li></ul></div>
                        <div class="ref-card"><h4>Emotional Appeals</h4><ul><li>Fear-based language</li><li>False urgency</li></ul></div>
                        <div class="ref-card"><h4>Cherry-Picking</h4><ul><li>Ignores contradictions</li><li>"Always/never" claims</li></ul></div>
                    </div>
                </div>
                <div class="quick-check">
                    <div class="quick-check-header">
                        <h3>My Quick Check: Evaluation Questions</h3>
                        <button class="add-question-btn" onclick="addQuestion('2')">+ Add</button>
                    </div>
                    <div class="quick-check-questions" id="questions-comp2"></div>
                </div>
                <div class="lessons-header">
                    <h3>Lessons</h3>
                    <button class="add-lesson-btn" onclick="addLesson('2')">+ Add Lesson</button>
                </div>
                <div id="lessons-comp2"></div>
            </div>
        </div>

        <!-- COMPETENCY 3 -->
        <div class="comp-section comp3" id="comp3Section">
            <div class="comp-section-header">
                <h2>Competency 3: Explains Real-World Systems</h2>
                <p>Analyze claims within system context and multiple perspectives</p>
            </div>
            <div class="comp-section-body">
                <!-- Reference Content for Comp 3 -->
                <div style="margin-bottom: 20px;">
                    <div class="content-block-title">Quick Reference: Systems Thinking</div>
                    <div class="ref-grid">
                        <div class="ref-card"><h4>Context</h4><ul><li>What system is this about?</li><li>Key components?</li></ul></div>
                        <div class="ref-card"><h4>Perspectives</h4><ul><li>Who benefits/harmed?</li><li>What's missing?</li></ul></div>
                        <div class="ref-card"><h4>Feedback Loops</h4><ul><li>Reinforcing or balancing?</li><li>Unintended effects?</li></ul></div>
                        <div class="ref-card"><h4>Stakeholders</h4><ul><li>Who is affected?</li><li>Equitable impacts?</li></ul></div>
                    </div>
                </div>
                <div class="quick-check">
                    <div class="quick-check-header">
                        <h3>My Quick Check: Systems Questions</h3>
                        <button class="add-question-btn" onclick="addQuestion('3')">+ Add</button>
                    </div>
                    <div class="quick-check-questions" id="questions-comp3"></div>
                </div>
                <div class="lessons-header">
                    <h3>Lessons</h3>
                    <button class="add-lesson-btn" onclick="addLesson('3')">+ Add Lesson</button>
                </div>
                <div id="lessons-comp3"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn primary" onclick="exportPDF()">Export as PDF</button>
            <button class="action-btn secondary" onclick="window.print()">Print Guide</button>
            <button class="action-btn danger" onclick="clearAllData()">Reset Guide</button>
        </div>
    </main>

    <footer>
        <p><strong>Exploring Systems Like a Scientist</strong> | Claim Evaluation Quick Guide</p>
        <p style="margin-top: 4px;">Export to PDF to upload to your Achievement Wallet.</p>
    </footer>

    <script>
        let currentComp = '1';
        let showAll = false;
        let guideData = {
            studentName: '',
            lastUpdated: '',
            questions: {
                '1': [
                    { id: 'q1_1', text: "What specific evidence is provided?" },
                    { id: 'q1_2', text: "Is the evidence specific or vague?" },
                    { id: 'q1_3', text: "Where did the evidence come from?" },
                    { id: 'q1_4', text: "Can I verify it independently?" }
                ],
                '2': [
                    { id: 'q2_1', text: "Is there a mechanism explaining HOW?" },
                    { id: 'q2_2', text: "Could something else explain this?" },
                    { id: 'q2_3', text: "Is correlation confused with causation?" },
                    { id: 'q2_4', text: "Are there logical gaps or assumptions?" }
                ],
                '3': [
                    { id: 'q3_1', text: "What system does this relate to?" },
                    { id: 'q3_2', text: "Who are the stakeholders affected?" },
                    { id: 'q3_3', text: "Are there feedback loops involved?" },
                    { id: 'q3_4', text: "What are potential unintended consequences?" }
                ]
            },
            lessons: {
                '1': [
                    { id: 'l1_1', name: 'Lesson 1', notes: [], examples: [], images: [] },
                    { id: 'l1_2', name: 'Lesson 2', notes: [], examples: [], images: [] },
                    { id: 'l1_3', name: 'Lesson 3', notes: [], examples: [], images: [] },
                    { id: 'l1_4', name: 'Lesson 4', notes: [], examples: [], images: [] },
                    { id: 'l1_5', name: 'Lesson 5', notes: [], examples: [], images: [] }
                ],
                '2': [
                    { id: 'l2_1', name: 'Lesson 1', notes: [], examples: [], images: [] },
                    { id: 'l2_2', name: 'Lesson 2', notes: [], examples: [], images: [] },
                    { id: 'l2_3', name: 'Lesson 3', notes: [], examples: [], images: [] },
                    { id: 'l2_4', name: 'Lesson 4', notes: [], examples: [], images: [] },
                    { id: 'l2_5', name: 'Lesson 5', notes: [], examples: [], images: [] }
                ],
                '3': [
                    { id: 'l3_1', name: 'Lesson 1', notes: [], examples: [], images: [] },
                    { id: 'l3_2', name: 'Lesson 2', notes: [], examples: [], images: [] },
                    { id: 'l3_3', name: 'Lesson 3', notes: [], examples: [], images: [] },
                    { id: 'l3_4', name: 'Lesson 4', notes: [], examples: [], images: [] },
                    { id: 'l3_5', name: 'Lesson 5', notes: [], examples: [], images: [] }
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', function() { loadData(); updateView(); updateProgress(); updateDate(); });

        function setComp(comp) { 
            currentComp = comp; 
            document.querySelectorAll('.comp-tab').forEach(t => t.classList.toggle('active', t.dataset.comp === comp));
            updateView();
        }

        function toggleView() {
            showAll = document.getElementById('viewToggle').checked;
            updateView();
        }

        function updateView() {
            document.querySelectorAll('.comp-section').forEach(s => s.classList.remove('visible'));
            if (showAll) {
                document.querySelectorAll('.comp-section').forEach(s => s.classList.add('visible'));
            } else {
                document.getElementById(`comp${currentComp}Section`).classList.add('visible');
            }
        }

        // Lessons
        function addLesson(comp) {
            const id = 'l' + comp + '_' + Date.now();
            const num = guideData.lessons[comp].length + 1;
            guideData.lessons[comp].push({ id, name: `Lesson ${num}`, notes: [], examples: [], images: [] });
            renderLessons(comp);
            saveData();
        }

        function updateLessonName(comp, lessonId, name) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) { lesson.name = name; saveData(); }
        }

        function deleteLesson(comp, lessonId) {
            if (guideData.lessons[comp].length <= 1) { alert('Must have at least one lesson.'); return; }
            if (confirm('Delete this lesson and all its content?')) {
                guideData.lessons[comp] = guideData.lessons[comp].filter(l => l.id !== lessonId);
                renderLessons(comp);
                saveData();
            }
        }

        function toggleLesson(lessonId) {
            document.getElementById(lessonId).classList.toggle('open');
        }

        function renderLessons(comp) {
            const container = document.getElementById(`lessons-comp${comp}`);
            container.innerHTML = '';
            guideData.lessons[comp].forEach(lesson => {
                const card = document.createElement('div');
                card.className = 'lesson-card open';
                card.id = lesson.id;
                card.innerHTML = `
                    <div class="lesson-card-header">
                        <input type="text" class="lesson-name-input" value="${lesson.name}" onchange="updateLessonName('${comp}', '${lesson.id}', this.value)">
                        <div class="lesson-actions">
                            <button class="lesson-toggle-btn" onclick="toggleLesson('${lesson.id}')">▼</button>
                            <button class="delete-lesson-btn" onclick="deleteLesson('${comp}', '${lesson.id}')">Delete</button>
                        </div>
                    </div>
                    <div class="lesson-card-body">
                        <div class="content-block">
                            <div class="content-block-title">Notes</div>
                            <div class="notes-container" id="notes-${lesson.id}"></div>
                            <button class="add-btn" onclick="addNote('${comp}', '${lesson.id}')">+ Add Note</button>
                        </div>
                        <div class="content-block">
                            <div class="content-block-title">Claim Examples</div>
                            <div id="examples-${lesson.id}"></div>
                            <button class="add-btn" onclick="addExample('${comp}', '${lesson.id}')">+ Add Example</button>
                        </div>
                        <div class="content-block">
                            <div class="content-block-title">Images</div>
                            <div class="image-upload-area" onclick="document.getElementById('img-${lesson.id}').click()">
                                <input type="file" id="img-${lesson.id}" accept="image/*" multiple onchange="handleImageUpload(event, '${comp}', '${lesson.id}')">
                                <div class="upload-icon">+</div>
                                <div class="upload-text">Click to upload</div>
                            </div>
                            <div class="images-grid" id="images-${lesson.id}"></div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
                renderNotes(comp, lesson.id);
                renderExamples(comp, lesson.id);
                renderImages(comp, lesson.id);
            });
        }

        // Notes
        function addNote(comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) {
                lesson.notes.push({ id: 'n' + Date.now(), content: '', date: new Date().toLocaleDateString() });
                renderNotes(comp, lessonId);
                saveData();
            }
        }

        function updateNote(comp, lessonId, noteId, content) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const note = lesson?.notes.find(n => n.id === noteId);
            if (note) { note.content = content; saveData(); updateProgress(); }
        }

        function deleteNote(comp, lessonId, noteId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) {
                lesson.notes = lesson.notes.filter(n => n.id !== noteId);
                renderNotes(comp, lessonId);
                saveData();
            }
        }

        function renderNotes(comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const container = document.getElementById(`notes-${lessonId}`);
            if (!container || !lesson) return;
            container.innerHTML = '';
            lesson.notes.forEach(note => {
                const card = document.createElement('div');
                card.className = 'note-card';
                card.innerHTML = `<div class="note-card-header"><span class="note-date">${note.date}</span><button class="delete-btn" onclick="deleteNote('${comp}','${lessonId}','${note.id}')">×</button></div><textarea placeholder="Add note..." oninput="updateNote('${comp}','${lessonId}','${note.id}',this.value)">${note.content||''}</textarea>`;
                container.appendChild(card);
            });
        }

        // Examples
        function addExample(comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) {
                lesson.examples.push({ id: 'e' + Date.now(), source: '', claim: '', analysis: '', verdict: '', date: new Date().toLocaleDateString() });
                renderExamples(comp, lessonId);
                saveData();
            }
        }

        function updateExample(comp, lessonId, exId, field, value) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const ex = lesson?.examples.find(e => e.id === exId);
            if (ex) { ex[field] = value; saveData(); updateProgress(); }
        }

        function setVerdict(comp, lessonId, exId, v) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const ex = lesson?.examples.find(e => e.id === exId);
            if (ex) { ex.verdict = v; renderExamples(comp, lessonId); saveData(); updateProgress(); }
        }

        function deleteExample(comp, lessonId, exId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) {
                lesson.examples = lesson.examples.filter(e => e.id !== exId);
                renderExamples(comp, lessonId);
                saveData();
            }
        }

        function renderExamples(comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const container = document.getElementById(`examples-${lessonId}`);
            if (!container || !lesson) return;
            container.innerHTML = '';
            lesson.examples.forEach(ex => {
                const card = document.createElement('div');
                card.className = 'example-card';
                card.innerHTML = `<div class="example-header"><h4>Example<span class="example-date">${ex.date}</span></h4><button class="delete-btn" onclick="deleteExample('${comp}','${lessonId}','${ex.id}')">×</button></div><div class="example-body"><div class="example-field"><label>Source</label><input type="text" placeholder="Where from?" value="${ex.source||''}" oninput="updateExample('${comp}','${lessonId}','${ex.id}','source',this.value)"></div><div class="example-field"><label>Claim</label><textarea placeholder="The claim..." oninput="updateExample('${comp}','${lessonId}','${ex.id}','claim',this.value)">${ex.claim||''}</textarea></div><div class="example-field"><label>Analysis</label><textarea placeholder="Your analysis..." oninput="updateExample('${comp}','${lessonId}','${ex.id}','analysis',this.value)">${ex.analysis||''}</textarea></div><div class="example-field"><label>Verdict</label><div class="verdict-select"><div class="verdict-option ${ex.verdict==='strong'?'selected strong':''}" onclick="setVerdict('${comp}','${lessonId}','${ex.id}','strong')">Strong</div><div class="verdict-option ${ex.verdict==='mixed'?'selected mixed':''}" onclick="setVerdict('${comp}','${lessonId}','${ex.id}','mixed')">Mixed</div><div class="verdict-option ${ex.verdict==='weak'?'selected weak':''}" onclick="setVerdict('${comp}','${lessonId}','${ex.id}','weak')">Weak</div></div></div></div>`;
                container.appendChild(card);
            });
        }

        // Images
        function handleImageUpload(e, comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (!lesson) return;
            [...e.target.files].forEach(file => {
                if (file.type.startsWith('image/') && file.size <= 5*1024*1024) {
                    const r = new FileReader();
                    r.onload = function(ev) {
                        lesson.images.push({ id: 'i'+Date.now(), data: ev.target.result, caption: '' });
                        renderImages(comp, lessonId);
                        saveData();
                    };
                    r.readAsDataURL(file);
                }
            });
        }

        function removeImage(comp, lessonId, imgId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            if (lesson) {
                lesson.images = lesson.images.filter(i => i.id !== imgId);
                renderImages(comp, lessonId);
                saveData();
            }
        }

        function updateCaption(comp, lessonId, imgId, v) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const img = lesson?.images.find(i => i.id === imgId);
            if (img) { img.caption = v; saveData(); }
        }

        function renderImages(comp, lessonId) {
            const lesson = guideData.lessons[comp].find(l => l.id === lessonId);
            const container = document.getElementById(`images-${lessonId}`);
            if (!container || !lesson) return;
            container.innerHTML = '';
            lesson.images.forEach(img => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `<img src="${img.data}"><button class="remove-btn" onclick="removeImage('${comp}','${lessonId}','${img.id}')">×</button><div class="image-caption"><input type="text" placeholder="Caption..." value="${img.caption||''}" onchange="updateCaption('${comp}','${lessonId}','${img.id}',this.value)"></div>`;
                container.appendChild(card);
            });
        }

        function updateProgress() {
            let total = 0, done = 0;
            ['1','2','3'].forEach(c => {
                guideData.lessons[c].forEach(lesson => {
                    total += 1;
                    if (lesson.notes.some(n => n.content?.length > 10) || lesson.examples.some(e => e.claim && e.verdict)) done++;
                });
            });
            const pct = total > 0 ? Math.round((done/total)*100) : 0;
            document.getElementById('progressPercent').textContent = pct + '% Complete';
            document.getElementById('progressFill').style.width = pct + '%';
        }

        // Questions (per competency)
        function addQuestion(comp) {
            guideData.questions[comp].push({ id: 'q' + comp + '_' + Date.now(), text: '' });
            renderQuestions(comp);
            saveData();
        }

        function updateQuestion(comp, id, text) {
            const q = guideData.questions[comp].find(x => x.id === id);
            if (q) { q.text = text; saveData(); }
        }

        function deleteQuestion(comp, id) {
            if (guideData.questions[comp].length <= 1) { alert('Must have at least one question.'); return; }
            guideData.questions[comp] = guideData.questions[comp].filter(q => q.id !== id);
            renderQuestions(comp);
            saveData();
        }

        function renderQuestions(comp) {
            const container = document.getElementById(`questions-comp${comp}`);
            if (!container) return;
            container.innerHTML = '';
            guideData.questions[comp].forEach((q, idx) => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.innerHTML = `<span class="question-num">${idx + 1}.</span><input type="text" value="${q.text}" placeholder="Enter question..." onchange="updateQuestion('${comp}', '${q.id}', this.value)"><button class="delete-question-btn" onclick="deleteQuestion('${comp}', '${q.id}')">×</button>`;
                container.appendChild(item);
            });
        }

        function saveData() {
            guideData.studentName = document.getElementById('studentName').value;
            guideData.lastUpdated = new Date().toLocaleString();
            localStorage.setItem('claimGuideV7', JSON.stringify(guideData));
            document.getElementById('saveIndicator').textContent = 'Saved';
            setTimeout(() => document.getElementById('saveIndicator').textContent = 'Auto-saved', 1000);
            updateDate();
        }

        function loadData() {
            const s = localStorage.getItem('claimGuideV7');
            if (s) {
                guideData = JSON.parse(s);
                document.getElementById('studentName').value = guideData.studentName || '';
                if (!guideData.lessons) {
                    guideData.lessons = {
                        '1': [{ id: 'l1_1', name: 'Lesson 1', notes: [], examples: [], images: [] }],
                        '2': [{ id: 'l2_1', name: 'Lesson 1', notes: [], examples: [], images: [] }],
                        '3': [{ id: 'l3_1', name: 'Lesson 1', notes: [], examples: [], images: [] }]
                    };
                }
                if (!guideData.questions || Array.isArray(guideData.questions)) {
                    guideData.questions = {
                        '1': [
                            { id: 'q1_1', text: "What specific evidence is provided?" },
                            { id: 'q1_2', text: "Is the evidence specific or vague?" },
                            { id: 'q1_3', text: "Where did the evidence come from?" },
                            { id: 'q1_4', text: "Can I verify it independently?" }
                        ],
                        '2': [
                            { id: 'q2_1', text: "Is there a mechanism explaining HOW?" },
                            { id: 'q2_2', text: "Could something else explain this?" },
                            { id: 'q2_3', text: "Is correlation confused with causation?" },
                            { id: 'q2_4', text: "Are there logical gaps or assumptions?" }
                        ],
                        '3': [
                            { id: 'q3_1', text: "What system does this relate to?" },
                            { id: 'q3_2', text: "Who are the stakeholders affected?" },
                            { id: 'q3_3', text: "Are there feedback loops involved?" },
                            { id: 'q3_4', text: "What are potential unintended consequences?" }
                        ]
                    };
                }
            }
            ['1','2','3'].forEach(c => {
                renderLessons(c);
                renderQuestions(c);
            });
        }

        function updateDate() { document.getElementById('lastUpdated').value = guideData.lastUpdated || new Date().toLocaleString(); }
        function exportPDF() { showAll = true; document.getElementById('viewToggle').checked = true; updateView(); document.querySelectorAll('.lesson-card').forEach(c => c.classList.add('open')); setTimeout(() => window.print(), 300); }
        function clearAllData() { if (confirm('Reset everything?')) { localStorage.removeItem('claimGuideV7'); location.reload(); } }
    </script>
</body>
</html>
